# 運営者一覧画面設計書

- 画面名: `運営者一覧`
- パス: `/operation/admins`
- URL: https://carebase-admin.vercel.app/operation/admins

## 概要

運営者向け運営者一覧画面設計書です。
システム管理者の一覧表示、検索・フィルタリング機能、および各種操作（編集、削除、ステータス変更）機能を提供します。

主要機能は以下の通りです：

1. 運営者一覧の表示（テーブル形式）
2. リアルタイム検索機能（氏名、メールアドレス、部署）
3. ステータス管理（有効/無効の切り替え）
4. 各運営者への操作（編集、削除、ステータス変更）
5. 新規運営者登録への遷移
6. 最終ログイン日時の表示

## 全体レイアウト

### 画面構成

運営者一覧画面は、検索エリア、アクションボタンエリア、結果表示エリア、運営者テーブルで構成されます。
システム管理者の効率的な管理を支援するため、直感的で使いやすいデザインを採用しています。

### 画面項目

| 項目名             | コンポーネント | 必須 | 最小桁数 | 最大桁数 | フォーマット | 初期値                          | 備考                                                      |
| ------------------ | -------------- | ---- | -------- | -------- | ------------ | ------------------------------- | --------------------------------------------------------- |
| 検索ボックス       | Input          | -    | -        | -        | text         | -                               | プレースホルダー：「氏名、メールアドレス、部署で検索...」 |
| 管理者を登録ボタン | Button + Link  | -    | -        | -        | -            | 管理者を登録                    | 新規登録画面への遷移ボタン                                |
| 結果件数表示       | テキスト       | -    | -        | -        | -            | "X 件の管理者が見つかりました"  | 動的に件数を表示                                          |
| 運営者テーブル     | Table          | -    | -        | -        | -            | -                               | 運営者情報表示テーブル                                    |
| エラー表示         | ErrorMessage   | -    | -        | -        | -            | "エラーが発生しました: {error}" | データ取得エラー時の表示                                  |
| ローディング表示   | LoadingSpinner | -    | -        | -        | -            | "読み込み中..."                 | データ取得中の表示                                        |
| 空状態表示         | EmptyState     | -    | -        | -        | -            | "管理者が見つかりません"        | データが0件の場合の表示                                   |
| 削除確認ダイアログ | AlertDialog    | -    | -        | -        | -            | "管理者を削除しますか？"        | 削除実行前の確認ダイアログ                                |

## テーブル構造

### テーブル列定義

| 列名      | 表示名       | 幅    | ソート | 内容                                                 |
| --------- | ------------ | ----- | ------ | ---------------------------------------------------- |
| adminInfo | 管理者情報   | 300px | -      | 氏名、フリガナ、メールアドレス                       |
| contact   | 連絡先       | 200px | -      | 電話番号、部署                                       |
| status    | ステータス   | 120px | -      | 有効/無効ステータスバッジ                            |
| lastLogin | 最終ログイン | 120px | -      | 最終ログイン日時（YYYY/MM/DD形式）                   |
| actions   | 操作         | 60px  | -      | ドロップダウンメニュー（編集、ステータス変更、削除） |

### 管理者情報列の詳細表示

- **氏名**: 管理者の本名（太字表示）
- **フリガナ**: 氏名のフリガナ（小さめテキスト）
- **メールアドレス**: 等幅フォントで表示（小さめテキスト）

### 連絡先列の詳細表示

- **電話番号**: 等幅フォントで表示
- **部署**: 小さめテキストで表示（存在する場合のみ）

### ステータス表示

| ステータス | 表示名 | バッジカラー                           |
| ---------- | ------ | -------------------------------------- |
| active     | 有効   | 緑色 (bg-green-600 hover:bg-green-700) |
| inactive   | 無効   | 灰色 (secondary variant)               |

### 最終ログイン表示

- **フォーマット**: `YYYY/MM/DD` 形式
- **未ログイン**: "-" で表示
- **無効日付**: "-" で表示

## 機能仕様

### アクション

| 項目名             | 処理内容                 | 対象API                          | 遷移先画面                                    |
| ------------------ | ------------------------ | -------------------------------- | --------------------------------------------- |
| 検索ボックス入力   | リアルタイム検索実行     | -                                | -                                             |
| 管理者を登録ボタン | 新規登録画面へ遷移       | -                                | 管理者登録画面 (`/operation/admins/register`) |
| 編集メニュー       | 管理者編集画面へ遷移     | -                                | 管理者編集画面 (`/operation/admins/[id]`)     |
| ステータス変更     | 管理者ステータス変更処理 | `PUT /api/v1/admins/[id]/status` | -                                             |
| 削除メニュー       | 削除確認ダイアログ表示   | -                                | -                                             |
| 削除実行           | 管理者削除処理           | `DELETE /api/v1/admins/[id]`     | -                                             |

### 検索機能

#### 検索対象フィールド

- 氏名 (`name`)
- フリガナ (`nameKana`)
- メールアドレス (`email`)
- 電話番号 (`phoneNumber`)
- 部署 (`department`)

#### 検索仕様

- **リアルタイム検索**: 入力中に自動的に検索を実行
- **部分一致**: 入力された文字列を含む項目を検索
- **大文字小文字区別なし**: 英字の大文字小文字を区別せずに検索
- **クライアント側フィルタリング**: 取得済みデータから絞り込み
- **マウント制御**: コンポーネントマウント完了後に検索を有効化

### ステータス管理機能

#### ステータス変更処理

- **有効 ↔ 無効**: ワンクリックでステータス切り替え
- **楽観的更新**: 変更成功時に即座にUI更新
- **トースト通知**: ステータス変更成功時の通知表示
- **エラーハンドリング**: ステータス変更失敗時の適切な通知
- **処理中表示**: ステータス変更中のローディング表示

#### ステータス変更権限

- **自己変更禁止**: 自分自身のステータス変更は不可
- **権限チェック**: 適切な権限を持つユーザーのみ変更可能
- **監査ログ**: ステータス変更履歴の記録

### 状態管理

#### データフェッチング

- **初期読み込み**: コンポーネントマウント時に全件取得
- **自動更新**: 削除・ステータス変更後のデータ再取得
- **エラーハンドリング**: 取得失敗時の適切な表示
- **ローディング状態**: 取得中のスピナー表示

#### 削除処理

- **楽観的更新**: 削除成功時に即座にUI更新
- **確認ダイアログ**: 削除実行前の確認
- **トースト通知**: 削除成功時の通知表示
- **エラーハンドリング**: 削除失敗時の適切な通知

## コンポーネント構成

### 主要コンポーネント

- **AdminsPage** (`app/(dashboard)/operation/admins/page.tsx`)
  - ページ全体の制御とレイアウト
  - 検索状態とマウント状態の管理
  - useAdminsフックによるデータ管理
  - 検索フィルタリングの実装

- **AdminTable** (`components/3_organisms/tables/admin-table.tsx`)
  - テーブル全体の制御
  - ローディング・空状態の表示制御
  - 削除確認ダイアログの管理
  - ステータス変更処理の管理

- **AdminTableRow** (`components/2_molecules/tables/admin-table-row.tsx`)
  - 各行の表示制御
  - ドロップダウンメニューの実装
  - ステータスバッジの表示制御
  - 最終ログイン日時の表示

### UI コンポーネント

- **Input** (`components/ui/input.tsx`)
  - 検索ボックスの実装
  - アイコン付き入力フィールド

- **Button** (`components/ui/button.tsx`)
  - アクションボタンの実装
  - リンク機能付きボタン

- **Table関連** (`components/ui/table.tsx`)
  - Table, TableBody, TableHead, TableHeader, TableRow, TableCell
  - テーブル構造の基盤

- **Badge** (`components/ui/badge.tsx`)
  - ステータス表示用バッジ
  - バリアント対応

- **AlertDialog関連** (`components/ui/alert-dialog.tsx`)
  - 削除確認ダイアログの実装

- **DropdownMenu関連** (`components/ui/dropdown-menu.tsx`)
  - 操作メニューの実装

### カスタムフック

- **useAdmins** (`hooks/use-admins.ts`)
  - 運営者データの取得・管理
  - CRUD操作の実装
  - ローディング・エラー状態の管理
  - ステータス変更機能

### ユーティリティ関数

#### ステータスバッジ生成

```typescript
const getStatusBadge = (status: Admin['status']) => {
  switch (status) {
    case 'active':
      return (
        <Badge variant="default" className="bg-green-600 hover:bg-green-700 text-xs">
          有効
        </Badge>
      );
    case 'inactive':
      return (
        <Badge variant="secondary" className="text-xs">
          無効
        </Badge>
      );
    default:
      return (
        <Badge variant="outline" className="text-xs">
          {status}
        </Badge>
      );
  }
};
```

#### 日時フォーマット関数

```typescript
const formatDateTime = (dateString: string | null) => {
  if (!dateString) return '-';

  try {
    const date = new Date(dateString);
    return new Intl.DateTimeFormat('ja-JP', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit',
    }).format(date);
  } catch {
    return '-';
  }
};
```

## API仕様

### エンドポイント

| エンドポイント               | メソッド | 説明                 |
| ---------------------------- | -------- | -------------------- |
| `/api/v1/admins`             | GET      | 運営者一覧取得       |
| `/api/v1/admins`             | POST     | 運営者新規作成       |
| `/api/v1/admins/[id]`        | GET      | 運営者詳細取得       |
| `/api/v1/admins/[id]`        | PUT      | 運営者情報更新       |
| `/api/v1/admins/[id]`        | DELETE   | 運営者削除           |
| `/api/v1/admins/[id]/status` | PUT      | 運営者ステータス変更 |

### リクエスト仕様

#### 運営者一覧取得

```typescript
interface AdminFilters {
  search?: string;
  status?: 'active' | 'inactive';
  department?: string;
}
```

#### ステータス変更

```typescript
interface StatusUpdateRequest {
  status: 'active' | 'inactive';
}
```

#### レスポンス仕様

```typescript
interface Admin {
  id: string;
  name: string;
  nameKana: string;
  email: string;
  phoneNumber: string;
  department?: string;
  status: 'active' | 'inactive';
  lastLoginAt: string | null;
  createdAt: string;
  updatedAt: string;
}
```

## UI/UX仕様

### レスポンシブデザイン

- **デスクトップ**: フル機能のテーブル表示
- **タブレット**: 1024px以下でもテーブル構造を維持
- **モバイル**: 768px以下では適切なレイアウト調整

### アクセシビリティ

- **キーボードナビゲーション**: すべての操作がキーボードで実行可能
- **スクリーンリーダー対応**: 適切なARIA属性とalt属性
- **フォーカス管理**: 視覚的に明確なフォーカス表示
- **コントラスト比**: WCAG 2.1 AA準拠

### インタラクション

#### ホバー効果

- **テーブル行**: マウスオーバー時の背景色変更
- **ボタン**: ホバー時の色変更とトランジション
- **ドロップダウンメニュー**: スムーズなアニメーション

#### ローディング状態

- **初期読み込み**: 中央配置のスピナーとメッセージ
- **ステータス変更中**: 該当行のローディング表示
- **削除中**: ボタンの無効化

#### 空状態

- **データなし**: 中央配置のUsersアイコンとメッセージ
- **検索結果なし**: 検索条件変更を促すメッセージ
- **エラー状態**: 適切なエラーメッセージ表示

#### フィードバック

- **成功通知**: 操作成功時のトースト通知
- **エラー通知**: 操作失敗時のトースト通知
- **ステータス表示**: 視覚的に分かりやすいバッジ表示

### カラーテーマ

- **shadcn/ui**: デフォルトテーマを使用
- **ステータス色**: 有効（緑）、無効（灰）の明確な色分け
- **危険操作**: 削除ボタンは赤色系統
- **一貫性**: プロジェクト全体のデザインシステムに準拠

## パフォーマンス最適化

### データ管理

- **効率的フェッチ**: 必要なデータのみを取得
- **クライアント側フィルタリング**: 検索処理の高速化
- **メモ化**: 検索パラメータとフィルタリング結果のメモ化

### レンダリング最適化

- **React.memo**: 不要な再レンダリングの防止
- **useCallback**: イベントハンドラーのメモ化
- **useMemo**: フィルタリング処理のメモ化

### ネットワーク最適化

- **リクエスト最適化**: 不要なAPI呼び出しの削減
- **楽観的更新**: UI応答性向上のための即座の状態反映
- **エラーリトライ**: 失敗時の適切なリトライ機能

## セキュリティ仕様

### 入力検証

- **XSS対策**: Reactの自動エスケープ機能
- **入力サニタイズ**: 検索クエリの適切な処理
- **SQLインジェクション対策**: パラメータ化クエリの使用

### 認証・認可

- **JWT認証**: トークンベース認証
- **権限チェック**: 運営者権限の確認
- **操作権限**: 適切な権限を持つユーザーのみ操作可能

### データ保護

- **HTTPS通信**: 暗号化通信の強制
- **機密情報保護**: 適切なデータマスキング
- **監査ログ**: 操作履歴の記録

### 操作制限

- **自己操作制限**: 自分自身への危険な操作の制限
- **権限分離**: 適切な権限レベルでの操作制限
- **セッション管理**: 適切なセッション制御

## 開発環境での動作

### モックデータ

開発環境では以下のモック運営者データを使用：

- **ステータス**: 有効・無効の組み合わせ
- **部署**: 総務部、システム部、営業部等
- **最終ログイン**: 様々なログイン日時パターン
- **連絡先情報**: 電話番号、メールアドレス

### テスト機能

- **検索テスト**: 各種検索条件での動作確認
- **ステータス変更テスト**: 有効/無効切り替えの動作確認
- **削除テスト**: 削除処理の動作確認
- **エラーハンドリングテスト**: エラー状態の表示確認
- **レスポンシブテスト**: 各種画面サイズでの表示確認

## 参考資料

- [CareBase-admin プロジェクト](https://github.com/ambi-tious/CareBase-admin)
- [運営者画面一覧](../../../docs/運営者.md)
- [画面一覧インデックス](../../../docs/screen-list.md)
- [AdminTable コンポーネント](../../../components/3_organisms/tables/admin-table.tsx)
- [useAdmins フック](../../../hooks/use-admins.ts)
- [Admin 型定義](../../../types/admin.ts)
- [shadcn/ui ドキュメント](https://ui.shadcn.com/)
- [Lucide React アイコン](https://lucide.dev/)
