# 運営者登録画面設計書

- 画面名: `運営者登録`
- パス: `/operation/admins/register`
- URL: https://carebase-admin.vercel.app/operation/admins/register

## 概要

運営者向け運営者登録画面設計書です。
新しいシステム管理者の登録機能を提供し、基本情報と連絡先情報を入力して一時パスワード付きでアカウントを作成します。

主要機能は以下の通りです：

1. 運営者基本情報の登録（氏名、フリガナ、部署等）
2. 連絡先情報の登録（メールアドレス、電話番号）
3. 一時パスワード自動生成機能
4. 登録成功時のモーダル表示
5. 登録完了後の運営者一覧への遷移

## 全体レイアウト

### 画面構成

運営者登録画面は、ページヘッダー、フォームセクション、登録成功モーダルで構成されます。
効率的な管理者アカウント作成手続きを支援するため、必要な情報を一画面で完結できる設計を採用しています。

### 画面項目

| 項目名           | コンポーネント                | 必須 | 最小桁数 | 最大桁数 | フォーマット | 初期値                       | 備考                         |
| ---------------- | ----------------------------- | ---- | -------- | -------- | ------------ | ---------------------------- | ---------------------------- |
| 戻るボタン       | Button + Link                 | -    | -        | -        | -            | -                            | 運営者一覧画面への戻るボタン |
| ページタイトル   | h1                            | -    | -        | -        | -            | 運営管理者の登録             | ページメインタイトル         |
| ページ説明       | p                             | -    | -        | -        | -            | 新しい運営管理者を登録します | ページ説明文                 |
| 管理者フォーム   | AdminForm                     | -    | -        | -        | -            | -                            | 運営者情報入力フォーム       |
| 登録成功モーダル | AdminRegistrationSuccessModal | -    | -        | -        | -            | -                            | 登録成功時の確認モーダル     |

## フォーム構造

### 基本情報セクション

| 項目名   | コンポーネント | 必須 | 最小桁数 | 最大桁数 | フォーマット | プレースホルダー | バリデーション                                 |
| -------- | -------------- | ---- | -------- | -------- | ------------ | ---------------- | ---------------------------------------------- |
| 氏名     | Input          | ◯    | 1        | 50       | text         | 山田太郎         | 必須チェック、文字数チェック                   |
| フリガナ | Input          | ◯    | 1        | 50       | text         | ヤマダタロウ     | 必須チェック、カタカナチェック、文字数チェック |
| 部署     | Input          | -    | -        | 50       | text         | 総務部           | 文字数チェック（任意）                         |

### 連絡先情報セクション

| 項目名         | コンポーネント | 必須 | 最小桁数 | 最大桁数 | フォーマット | プレースホルダー  | バリデーション                             |
| -------------- | -------------- | ---- | -------- | -------- | ------------ | ----------------- | ------------------------------------------ |
| メールアドレス | Input          | ◯    | 1        | -        | email        | admin@example.com | 必須チェック、メールフォーマットチェック   |
| 電話番号       | Input          | ◯    | 1        | -        | text         | 03-1234-5678      | 必須チェック、電話番号フォーマットチェック |

## 機能仕様

### アクション

| 項目名     | 処理内容             | 対象API               | 遷移先画面                           |
| ---------- | -------------------- | --------------------- | ------------------------------------ |
| 戻るボタン | 運営者一覧画面へ戻る | -                     | 運営者一覧画面 (`/operation/admins`) |
| キャンセル | 運営者一覧画面へ戻る | -                     | 運営者一覧画面 (`/operation/admins`) |
| 登録ボタン | 運営者登録処理を実行 | `POST /api/v1/admins` | -                                    |
| 一覧へ戻る | 運営者一覧画面へ遷移 | -                     | 運営者一覧画面 (`/operation/admins`) |

### 登録処理フロー

#### 登録仕様

1. **データ検証**: フォーム入力データの包括的バリデーション
2. **API呼び出し**: 運営者作成API実行
3. **パスワード生成**: 管理者用一時パスワードの自動生成
4. **成功モーダル**: 登録結果の表示（管理者情報、一時パスワード）
5. **画面遷移**: 運営者一覧への自動遷移

#### 一時パスワード生成

- **自動生成**: サーバー側で安全な一時パスワードを生成
- **初回ログイン**: 初回ログイン時にパスワード変更を強制
- **セキュリティ**: 十分な複雑性を持つパスワード生成

### 状態管理

#### データ状態

- **registrationData**: 登録結果データ（管理者情報、一時パスワード）
- **isModalOpen**: 登録成功モーダルの表示状態

#### フォーム状態

- **AdminForm**: 運営者情報入力フォーム
- **バリデーション**: 入力データの検証
- **エラーハンドリング**: フィールド別のエラー表示

### バリデーション仕様

#### 運営者情報バリデーション

| 項目名         | バリデーション内容                                 |
| -------------- | -------------------------------------------------- |
| 氏名           | 必須、1-50文字                                     |
| フリガナ       | 必須、1-50文字、カタカナのみ（`/^[ァ-ヶー\s]+$/`） |
| 部署           | 任意、最大50文字                                   |
| メールアドレス | 必須、メールフォーマット、重複チェック             |
| 電話番号       | 必須、電話番号フォーマット                         |

## コンポーネント構成

### 主要コンポーネント

- **AdminRegisterPage** (`app/(dashboard)/operation/admins/register/page.tsx`)
  - ページ全体の制御とレイアウト
  - 登録処理とモーダル制御
  - useAdminsフックによる運営者管理
  - エラーハンドリングとフィードバック

- **AdminForm** (`components/2_molecules/forms/admin-form.tsx`)
  - 運営者情報入力フォームの実装
  - バリデーション機能
  - キャンセル・登録ボタンの制御

- **AdminRegistrationSuccessModal** (`components/2_molecules/modals/admin-registration-success-modal.tsx`)
  - 登録成功時のモーダル表示
  - 登録結果の詳細表示
  - 一時パスワードの表示と注意事項

### UI コンポーネント

- **Button** (`components/ui/button.tsx`)
  - 戻るボタン、登録ボタンの実装
  - ローディング状態対応

- **Input** (`components/ui/input.tsx`)
  - フォーム入力コンポーネント
  - バリデーション表示対応

### カスタムフック

- **useAdmins** (`hooks/use-admins.ts`)
  - addAdmin関数による運営者登録処理
  - エラーハンドリングと状態管理
  - 登録レスポンスの管理

## API仕様

### エンドポイント

| エンドポイント   | メソッド | 説明           |
| ---------------- | -------- | -------------- |
| `/api/v1/admins` | POST     | 運営者新規登録 |

### リクエスト仕様

#### 運営者新規登録

```typescript
interface AdminFormData {
  name: string;
  nameKana: string;
  email: string;
  phoneNumber: string;
  department?: string;
}
```

### レスポンス仕様

#### 登録成功レスポンス

```typescript
interface AdminRegistrationResponse {
  admin: {
    id: string;
    name: string;
    email: string;
  };
  temporaryPassword: string;
  message: string;
}
```

## UI/UX仕様

### レスポンシブデザイン

- **デスクトップ**: 中央配置のフォームレイアウト
- **タブレット**: 1024px以下でも適切なフォーム表示
- **モバイル**: 768px以下でも使いやすい入力体験を提供

### アクセシビリティ

- **ラベル関連付け**: 全入力フィールドに適切なラベル設定
- **キーボードナビゲーション**: Tab キーでの順次移動対応
- **エラー通知**: スクリーンリーダー対応のエラーメッセージ
- **フォーカス管理**: 視覚的に明確なフォーカス表示

### インタラクション

#### フォーム体験

- **セクション分け**: 基本情報と連絡先情報の明確な分離
- **リアルタイムバリデーション**: 入力中の即座なフィードバック
- **エラー表示**: フィールド下部のインラインエラー表示

#### 登録成功体験

- **成功モーダル**: 登録完了の明確な通知
- **重要情報表示**: 一時パスワード等の重要情報を強調表示
- **次のアクション**: 明確な次のステップの提示
- **セキュリティ注意**: 一時パスワードの取り扱い注意事項

#### ナビゲーション

- **戻る機能**: 複数の戻る手段の提供
- **キャンセル機能**: フォーム内でのキャンセル操作
- **明確な導線**: 次のアクションへの分かりやすい誘導

### カラーテーマ

- **shadcn/ui**: デフォルトテーマを使用
- **成功色**: 登録成功時の緑色系統
- **注意色**: 一時パスワード等の重要情報は黄色系統
- **エラー色**: バリデーションエラー時の赤色系統
- **一貫性**: プロジェクト全体のデザインシステムに準拠

## パフォーマンス最適化

### フォーム最適化

- **React Hook Form**: 効率的なフォーム状態管理
- **zodResolver**: 型安全なバリデーション
- **メモ化**: 不要な再レンダリングの防止

### ネットワーク最適化

- **楽観的更新**: 登録成功時の即座のUI更新
- **エラーリトライ**: 失敗時の適切なリトライ機能
- **タイムアウト処理**: 長時間処理に対する適切な処理

## セキュリティ仕様

### 入力検証

- **クライアント側バリデーション**: Zodスキーマによる厳密な入力検証
- **サーバー側バリデーション**: APIレベルでの二重チェック
- **XSS対策**: Reactの自動エスケープ機能
- **重複チェック**: メールアドレスの重複確認

### パスワード管理

- **一時パスワード**: サーバー側でのセキュアな一時パスワード生成
- **パスワード表示**: 安全な一時表示と注意喚起
- **初回ログイン**: パスワード変更の強制

### データ保護

- **HTTPS通信**: 暗号化通信の強制
- **機密情報保護**: 適切なデータハンドリング
- **監査ログ**: 登録操作の記録

### アクセス制御

- **権限チェック**: 運営者権限を持つユーザーのみ登録可能
- **セッション管理**: 適切なセッション制御
- **操作制限**: 適切な権限レベルでの操作制限

## 開発環境での動作

### モック機能

- **開発環境**: モック登録処理による動作シミュレーション
- **一時パスワード**: ランダム生成による実際の動作確認
- **エラーテスト**: 意図的なエラー発生によるエラーハンドリングテスト

### テスト機能

- **フォームテスト**: 各種入力パターンでのバリデーション確認
- **登録処理テスト**: 正常系・異常系での動作確認
- **モーダルテスト**: 成功モーダルの表示・操作確認
- **重複チェックテスト**: メールアドレス重複時の動作確認
- **レスポンシブテスト**: 各種画面サイズでの表示確認

## 参考資料

- [CareBase-admin プロジェクト](https://github.com/ambi-tious/CareBase-admin)
- [運営者一覧画面](../README.md)
- [運営者画面一覧](../../../../docs/運営者.md)
- [AdminForm コンポーネント](../../../../components/2_molecules/forms/admin-form.tsx)
- [AdminRegistrationSuccessModal コンポーネント](../../../../components/2_molecules/modals/admin-registration-success-modal.tsx)
- [useAdmins フック](../../../../hooks/use-admins.ts)
- [Admin 型定義](../../../../types/admin.ts)
- [Admin バリデーション](../../../../validations/admin-validation.ts)
- [React Hook Form ドキュメント](https://react-hook-form.com/)
- [Zod ドキュメント](https://zod.dev/)
- [shadcn/ui ドキュメント](https://ui.shadcn.com/)
