# 会社登録画面設計書

- 画面名: `会社登録`
- パス: `/operation/companies/register`
- URL: https://carebase-admin.vercel.app/operation/companies/register

## 概要

運営者向け会社登録画面設計書です。
新しい会社の基本情報、連絡先情報、代表者情報、その他情報を入力して登録する機能を提供します。

主要機能は以下の通りです：

1. 多段階のフォーム入力（基本情報、連絡先、代表者、その他）
2. リアルタイムバリデーション機能
3. 入力データの検証とエラー表示
4. 登録処理とフィードバック表示
5. 会社一覧画面への遷移

## 全体レイアウト

### 画面構成

会社登録画面は、ページヘッダー、フォームセクション（4つのカード）、アクションボタンで構成されます。
直感的で使いやすいフォーム設計により、効率的な会社情報入力を支援します。

### 画面項目

| 項目名           | コンポーネント | 必須 | 最小桁数 | 最大桁数 | フォーマット | 初期値                 | 備考                                             |
| ---------------- | -------------- | ---- | -------- | -------- | ------------ | ---------------------- | ------------------------------------------------ |
| 戻るボタン       | Button + Link  | -    | -        | -        | -            | -                      | 会社一覧画面への戻るボタン                       |
| ページタイトル   | h1             | -    | -        | -        | -            | 会社登録               | ページメインタイトル                             |
| ページ説明       | p              | -    | -        | -        | -            | 新しい会社を登録します | ページ説明文                                     |
| 基本情報カード   | Card           | -    | -        | -        | -            | -                      | 会社の基本情報入力セクション                     |
| 連絡先情報カード | Card           | -    | -        | -        | -            | -                      | 連絡先情報入力セクション                         |
| 代表者情報カード | Card           | -    | -        | -        | -            | -                      | 代表者情報入力セクション                         |
| その他情報カード | Card           | -    | -        | -        | -            | -                      | その他の情報入力セクション                       |
| リセットボタン   | Button         | -    | -        | -        | -            | リセット               | フォーム内容をリセット                           |
| 登録ボタン       | Button         | -    | -        | -        | -            | 登録する               | 登録処理実行ボタン、ローディング状態表示機能付き |

## フォーム構造

### 基本情報セクション

| 項目名         | コンポーネント | 必須 | 最小桁数 | 最大桁数 | フォーマット | プレースホルダー         | バリデーション                                 |
| -------------- | -------------- | ---- | -------- | -------- | ------------ | ------------------------ | ---------------------------------------------- |
| 会社名         | Input          | ◯    | 1        | 100      | text         | 株式会社サンプル         | 必須チェック、文字数チェック                   |
| 会社名（カナ） | Input          | ◯    | 1        | 100      | text         | カブシキガイシャサンプル | 必須チェック、カタカナチェック、文字数チェック |
| 法人番号       | Input          | -    | 13       | 13       | text         | 1234567890123            | 13桁数字チェック（任意）                       |
| 事業種別       | Select         | ◯    | -        | -        | select       | -                        | 必須チェック                                   |
| 設立日         | Input          | -    | -        | -        | date         | -                        | 日付フォーマットチェック（任意）               |
| ステータス     | Select         | -    | -        | -        | select       | 有効                     | デフォルト値設定                               |
| 住所           | Input          | ◯    | 1        | 200      | text         | 東京都渋谷区...          | 必須チェック、文字数チェック                   |

#### 事業種別選択肢

| 値        | 表示名 |
| --------- | ------ |
| medical   | 医療   |
| nursing   | 介護   |
| welfare   | 福祉   |
| education | 教育   |
| other     | その他 |

#### ステータス選択肢

| 値        | 表示名   |
| --------- | -------- |
| active    | 有効     |
| inactive  | 無効     |
| suspended | 一時停止 |

### 連絡先情報セクション

| 項目名         | コンポーネント | 必須 | 最小桁数 | 最大桁数 | フォーマット | プレースホルダー | バリデーション                             |
| -------------- | -------------- | ---- | -------- | -------- | ------------ | ---------------- | ------------------------------------------ |
| 電話番号       | Input          | ◯    | 1        | -        | text         | 03-1234-5678     | 必須チェック、電話番号フォーマットチェック |
| メールアドレス | Input          | ◯    | 1        | -        | email        | info@example.com | 必須チェック、メールフォーマットチェック   |

### 代表者情報セクション

| 項目名   | コンポーネント | 必須 | 最小桁数 | 最大桁数 | フォーマット | プレースホルダー | バリデーション               |
| -------- | -------------- | ---- | -------- | -------- | ------------ | ---------------- | ---------------------------- |
| 代表者名 | Input          | ◯    | 1        | 50       | text         | 山田太郎         | 必須チェック、文字数チェック |
| 役職     | Input          | -    | -        | 50       | text         | 代表取締役       | 文字数チェック（任意）       |

### その他情報セクション

| 項目名   | コンポーネント | 必須 | 最小桁数 | 最大桁数 | フォーマット | プレースホルダー                     | バリデーション              |
| -------- | -------------- | ---- | -------- | -------- | ------------ | ------------------------------------ | --------------------------- |
| 資本金   | Input          | -    | -        | 50       | text         | 1000万円                             | 文字数チェック（任意）      |
| 従業員数 | Input          | -    | 1        | -        | number       | 100                                  | 1以上の数値チェック（任意） |
| 備考     | Textarea       | -    | -        | 1000     | text         | その他の情報があれば入力してください | 文字数チェック（任意）      |

## 機能仕様

### アクション

| 項目名         | 処理内容             | 対象API                  | 遷移先画面                            |
| -------------- | -------------------- | ------------------------ | ------------------------------------- |
| 戻るボタン     | 会社一覧画面へ戻る   | -                        | 会社一覧画面 (`/operation/companies`) |
| リセットボタン | フォーム内容をクリア | -                        | -                                     |
| 登録ボタン     | 会社登録処理を実行   | `POST /api/v1/companies` | 会社一覧画面 (`/operation/companies`) |

### バリデーション仕様

#### リアルタイムバリデーション

- **React Hook Form + Zod**: zodResolverによる型安全なバリデーション
- **フィールドレベル**: 各入力フィールドでリアルタイムバリデーション実行
- **エラー表示**: バリデーションエラー時にフィールド下部に赤色でエラーメッセージ表示
- **フィールドハイライト**: エラー状態のフィールドを赤色でハイライト

#### バリデーション項目

| 項目名         | バリデーション内容                                  |
| -------------- | --------------------------------------------------- |
| 会社名         | 必須、1-100文字                                     |
| 会社名（カナ） | 必須、1-100文字、カタカナのみ（`/^[ァ-ヶー\s]+$/`） |
| 法人番号       | 任意、13桁の数字（`/^\d{13}$/`）                    |
| 住所           | 必須、1-200文字                                     |
| 電話番号       | 必須、電話番号フォーマット（`/^[\d-+()]+$/`）       |
| メールアドレス | 必須、メールフォーマット                            |
| 代表者名       | 必須、1-50文字                                      |
| 役職           | 任意、最大50文字                                    |
| 事業種別       | 必須、選択肢から選択                                |
| 設立日         | 任意、有効な日付フォーマット                        |
| 資本金         | 任意、最大50文字                                    |
| 従業員数       | 任意、1以上の数値                                   |
| 備考           | 任意、最大1000文字                                  |

#### フォームバリデーション

- **送信前チェック**: 全必須項目が有効かつ入力済みの場合のみ送信ボタンを有効化
- **無効状態**: バリデーションエラーがある場合は送信ボタンを無効化
- **動的検証**: 入力値の変更に応じてリアルタイムで有効性チェック

### 状態管理

#### フォーム状態

- **React Hook Form**: useFormフックによる効率的なフォーム状態管理
- **デフォルト値**: 各フィールドに適切なデフォルト値を設定
- **リセット機能**: リセットボタンでデフォルト値に復元
- **送信後処理**: 登録成功時にフォームをリセット

#### ローディング状態

- **送信中表示**: 登録処理中はローディング状態を表示
- **ボタン無効化**: 処理中は全ボタンを無効化して重複送信を防止
- **ボタンテキスト変更**: 「登録する」→「処理中...」に変更

#### エラーハンドリング

- **API エラー**: 登録処理失敗時にトースト通知でエラー表示
- **ネットワークエラー**: 通信エラー時の適切なメッセージ表示
- **バリデーションエラー**: フィールド単位でのエラーメッセージ表示

## コンポーネント構成

### 主要コンポーネント

- **RegisterCompanyPage** (`app/(dashboard)/operation/companies/register/page.tsx`)
  - ページ全体の制御とレイアウト
  - フォーム送信処理とエラーハンドリング
  - ローディング状態の管理
  - 成功時の画面遷移制御

- **CompanyForm** (`components/2_molecules/forms/company-form.tsx`)
  - フォーム全体の制御とレイアウト
  - mode="create"で登録モードに設定
  - React Hook Form + Zod による型安全なフォーム管理
  - 4つのカードセクションによる情報分類

### UI コンポーネント

- **Card関連** (`components/ui/card.tsx`)
  - Card, CardContent, CardHeader, CardTitle
  - 情報セクションのコンテナとして使用

- **Form関連** (`components/ui/form.tsx`)
  - Form コンポーネント
  - React Hook Form との統合

- **Input関連** (`components/ui/input.tsx`)
  - 各種入力フィールドの実装

- **Button** (`components/ui/button.tsx`)
  - 戻る、リセット、登録ボタンの実装

- **Select関連** (`components/ui/select.tsx`)
  - 事業種別、ステータス選択の実装

### フォームフィールドコンポーネント

- **InputField** (`components/2_molecules/forms/form-field.tsx`)
  - テキスト入力フィールドの統一コンポーネント
  - ラベル、エラーメッセージ、説明文の統合表示

- **SelectField** (`components/2_molecules/forms/form-field.tsx`)
  - 選択フィールドの統一コンポーネント
  - オプション配列による動的選択肢生成

- **TextareaField** (`components/2_molecules/forms/form-field.tsx`)
  - テキストエリアフィールドの統一コンポーネント
  - 複数行テキスト入力対応

### カスタムフック

- **useCompanies** (`hooks/use-companies.ts`)
  - createCompany関数による会社作成処理
  - エラーハンドリングと状態管理
  - 楽観的更新による UI 応答性向上

## API仕様

### エンドポイント

| エンドポイント      | メソッド | 説明         |
| ------------------- | -------- | ------------ |
| `/api/v1/companies` | POST     | 会社新規作成 |

### リクエスト仕様

```typescript
interface CreateCompanyRequest {
  name: string;
  nameKana: string;
  corporateNumber?: string;
  address: string;
  phoneNumber: string;
  email: string;
  representativeName: string;
  representativePosition?: string;
  businessType: string;
  establishedDate?: string;
  capital?: string;
  employeeCount?: number;
  status?: 'active' | 'inactive' | 'suspended';
  notes?: string;
}
```

### レスポンス仕様

```typescript
interface CreateCompanyResponse {
  id: string;
  name: string;
  nameKana: string;
  corporateNumber?: string;
  address: string;
  phoneNumber: string;
  email: string;
  representativeName: string;
  representativePosition?: string;
  businessType: string;
  establishedDate?: string;
  capital?: string;
  employeeCount?: number;
  status: 'active' | 'inactive' | 'suspended';
  notes?: string;
  createdAt: string;
  updatedAt: string;
}
```

## UI/UX仕様

### レスポンシブデザイン

- **デスクトップ**: 2列グリッドレイアウトでフィールドを効率的に配置
- **タブレット**: 1024px以下では1列レイアウトに変更
- **モバイル**: 768px以下でも適切な入力体験を提供

### アクセシビリティ

- **ラベル関連付け**: 全入力フィールドに適切なラベル設定
- **キーボードナビゲーション**: Tab キーでの順次移動対応
- **エラー通知**: スクリーンリーダー対応のエラーメッセージ
- **フォーカス管理**: 視覚的に明確なフォーカス表示

### インタラクション

#### フィールド状態

- **デフォルト**: 通常の入力状態
- **フォーカス**: フィールドフォーカス時のハイライト表示
- **エラー**: バリデーションエラー時の赤色ハイライト
- **無効**: ローディング中の入力無効化

#### ボタン状態

- **通常**: クリック可能状態
- **無効**: バリデーションエラー時やローディング中の無効状態
- **ローディング**: 処理中のスピナー表示
- **ホバー**: マウスオーバー時の視覚的フィードバック

#### フィードバック

- **成功通知**: 登録成功時のトースト通知
- **エラー通知**: 登録失敗時のトースト通知
- **バリデーションエラー**: フィールド下部のインラインエラー表示

### カラーテーマ

- **shadcn/ui**: デフォルトテーマを使用
- **エラー色**: 赤色系統でエラー状態を表示
- **成功色**: 緑色系統で成功状態を表示
- **一貫性**: プロジェクト全体のデザインシステムに準拠

## パフォーマンス最適化

### フォーム最適化

- **React Hook Form**: 効率的なフォーム状態管理とレンダリング最適化
- **zodResolver**: 型安全なバリデーションとパフォーマンス向上
- **メモ化**: 不要な再レンダリングの防止

### ネットワーク最適化

- **楽観的更新**: 登録成功時の即座のUI更新
- **エラーリトライ**: 失敗時の適切なエラーハンドリング
- **タイムアウト処理**: 長時間の処理に対する適切な処理

## セキュリティ仕様

### 入力検証

- **クライアント側バリデーション**: Zodスキーマによる厳密な入力検証
- **サーバー側バリデーション**: APIレベルでの二重チェック
- **XSS対策**: Reactの自動エスケープ機能
- **SQLインジェクション対策**: パラメータ化クエリの使用

### データ保護

- **HTTPS通信**: 暗号化通信の強制
- **機密情報保護**: 適切なデータハンドリング
- **入力サニタイズ**: 悪意のある入力に対する対策

## 開発環境での動作

### モック機能

- **開発環境**: モックサービスによる登録処理シミュレーション
- **遅延シミュレーション**: 500msの遅延で実際のAPI通信を模擬
- **エラーテスト**: 意図的なエラー発生によるエラーハンドリングテスト

### テスト機能

- **バリデーションテスト**: 各種入力パターンでのバリデーション確認
- **フォーム送信テスト**: 正常系・異常系での動作確認
- **UI状態テスト**: ローディング・エラー状態の表示確認

## 参考資料

- [CareBase-admin プロジェクト](https://github.com/ambi-tious/CareBase-admin)
- [会社一覧画面](../README.md)
- [運営者画面一覧](../../../../docs/運営者.md)
- [CompanyForm コンポーネント](../../../../components/2_molecules/forms/company-form.tsx)
- [useCompanies フック](../../../../hooks/use-companies.ts)
- [Company バリデーション](../../../../validations/company-validation.ts)
- [React Hook Form ドキュメント](https://react-hook-form.com/)
- [Zod ドキュメント](https://zod.dev/)
- [shadcn/ui ドキュメント](https://ui.shadcn.com/)
