# 会社一覧画面設計書

- 画面名: `会社一覧`
- パス: `/operation/companies`
- URL: https://carebase-admin.vercel.app/operation/companies

## 概要

運営者向け会社一覧画面設計書です。
登録されている会社の一覧表示、検索・フィルタリング機能、および各種操作（詳細表示、編集、削除）機能を提供します。

主要機能は以下の通りです：

1. 会社一覧の表示（テーブル形式）
2. リアルタイム検索機能
3. ソート機能（会社名、代表者名、事業種別、登録日）
4. 各会社への操作（詳細表示、編集、削除）
5. 新規会社登録への遷移

## 全体レイアウト

### 画面構成

会社一覧画面は、検索エリア、アクションボタンエリア、結果表示エリア、会社テーブルで構成されます。
効率的な会社管理を支援するため、直感的で使いやすいデザインを採用しています。

### 画面項目

| 項目名             | コンポーネント | 必須 | 最小桁数 | 最大桁数 | フォーマット | 初期値                       | 備考                                                  |
| ------------------ | -------------- | ---- | -------- | -------- | ------------ | ---------------------------- | ----------------------------------------------------- |
| 検索ボックス       | Input          | -    | -        | -        | text         | -                            | プレースホルダー：「会社名、代表者名、住所で検索...」 |
| 会社を登録ボタン   | Button + Link  | -    | -        | -        | -            | 会社を登録                   | 新規登録画面への遷移ボタン                            |
| 結果件数表示       | テキスト       | -    | -        | -        | -            | "X 件の会社が見つかりました" | 動的に件数を表示                                      |
| 会社テーブル       | Table          | -    | -        | -        | -            | -                            | ソート機能付きテーブル                                |
| ローディング表示   | LoadingSpinner | -    | -        | -        | -            | "読み込み中..."              | データ取得中の表示                                    |
| 空状態表示         | EmptyState     | -    | -        | -        | -            | "会社が見つかりません"       | データが0件の場合の表示                               |
| 削除確認ダイアログ | AlertDialog    | -    | -        | -        | -            | "会社を削除しますか？"       | 削除実行前の確認ダイアログ                            |

## テーブル構造

### テーブル列定義

| 列名           | 表示名     | 幅    | ソート | 内容                                             |
| -------------- | ---------- | ----- | ------ | ------------------------------------------------ |
| company        | 会社情報   | 300px | ◯      | 会社名（リンク）、住所、電話番号、メールアドレス |
| representative | 代表者情報 | 200px | ◯      | 代表者名、役職                                   |
| businessType   | 事業種別   | 150px | ◯      | 事業種別                                         |
| status         | ステータス | 120px | -      | アクティブ/非アクティブ/一時停止                 |
| createdAt      | 登録日     | 100px | ◯      | 登録日時（YYYY/MM/DD形式）                       |
| actions        | 操作       | 60px  | -      | ドロップダウンメニュー（詳細表示、編集、削除）   |

### 会社情報列の詳細表示

- **会社名**: クリック可能なリンク（詳細画面へ遷移）
- **住所**: アイコン付きで表示
- **電話番号**: アイコン付きで表示（存在する場合のみ）
- **メールアドレス**: アイコン付きで表示（存在する場合のみ）

### ステータス表示

| ステータス | 表示名       | カラー                               |
| ---------- | ------------ | ------------------------------------ |
| active     | アクティブ   | 緑色 (bg-green-100 text-green-800)   |
| inactive   | 非アクティブ | 灰色 (bg-gray-100 text-gray-800)     |
| suspended  | 一時停止     | 黄色 (bg-yellow-100 text-yellow-800) |

## 機能仕様

### アクション

| 項目名             | 処理内容               | 対象API                         | 遷移先画面                                      |
| ------------------ | ---------------------- | ------------------------------- | ----------------------------------------------- |
| 検索ボックス入力   | リアルタイム検索実行   | `/api/v1/companies`             | -                                               |
| 会社を登録ボタン   | 新規登録画面へ遷移     | -                               | 会社登録画面 (`/operation/companies/register`)  |
| 会社名リンク       | 会社詳細画面へ遷移     | -                               | 会社詳細画面 (`/operation/companies/[id]`)      |
| テーブルヘッダー   | ソート実行             | -                               | -                                               |
| 詳細を見るメニュー | 会社詳細画面へ遷移     | -                               | 会社詳細画面 (`/operation/companies/[id]`)      |
| 編集メニュー       | 会社編集画面へ遷移     | -                               | 会社編集画面 (`/operation/companies/[id]/edit`) |
| 削除メニュー       | 削除確認ダイアログ表示 | -                               | -                                               |
| 削除実行           | 会社削除処理           | `DELETE /api/v1/companies/[id]` | -                                               |

### 検索機能

#### 検索対象フィールド

- 会社名 (`name`)
- 会社名カナ (`nameKana`)
- 住所 (`address`)
- 代表者名 (`representativeName`)

#### 検索仕様

- **リアルタイム検索**: 入力中に自動的に検索を実行
- **部分一致**: 入力された文字列を含む項目を検索
- **大文字小文字区別なし**: 英字の大文字小文字を区別せずに検索
- **マウント制御**: コンポーネントマウント完了後に検索を有効化
- **デバウンス**: 入力頻度に応じた最適化（実装済み）

### ソート機能

#### ソート対象列

| 列名       | ソートキー           | デフォルト |
| ---------- | -------------------- | ---------- |
| 会社情報   | `name`               | 昇順       |
| 代表者情報 | `representativeName` | -          |
| 事業種別   | `businessType`       | -          |
| 登録日     | `createdAt`          | -          |

#### ソート仕様

- **双方向ソート**: 昇順 ↔ 降順の切り替え
- **視覚的フィードバック**: ソート方向をアイコンで表示
- **文字列ソート**: 大文字小文字を区別せずにソート
- **日付ソート**: ISO文字列を日付として比較

### 状態管理

#### データフェッチング

- **初期読み込み**: コンポーネントマウント時に全件取得
- **検索連動**: 検索クエリ変更時に自動再取得
- **エラーハンドリング**: 取得失敗時の適切な表示
- **ローディング状態**: 取得中のスピナー表示

#### 削除処理

- **楽観的更新**: 削除成功時に即座にUI更新
- **確認ダイアログ**: 削除実行前の確認
- **エラーハンドリング**: 削除失敗時の適切な通知

## コンポーネント構成

### 主要コンポーネント

- **CompaniesPage** (`app/(dashboard)/operation/companies/page.tsx`)
  - ページ全体の制御とレイアウト
  - 検索状態とマウント状態の管理
  - useCompaniesフックによるデータ管理

- **CompanyTable** (`components/3_organisms/tables/company-table.tsx`)
  - テーブル全体の制御
  - ソート機能の実装
  - ローディング・空状態の表示制御
  - 削除確認ダイアログの管理

- **CompanyTableRow** (`components/2_molecules/tables/company-table-row.tsx`)
  - 各行の表示制御
  - ドロップダウンメニューの実装
  - ステータス表示の制御

### UI コンポーネント

- **Input** (`components/ui/input.tsx`)
  - 検索ボックスの実装
  - アイコン付き入力フィールド

- **Button** (`components/ui/button.tsx`)
  - アクションボタンの実装
  - リンク機能付きボタン

- **Table関連** (`components/ui/table.tsx`)
  - Table, TableBody, TableHead, TableHeader, TableRow, TableCell
  - テーブル構造の基盤

- **AlertDialog関連** (`components/ui/alert-dialog.tsx`)
  - 削除確認ダイアログの実装

- **Badge** (`components/ui/badge.tsx`)
  - ステータス表示用バッジ

- **DropdownMenu関連** (`components/ui/dropdown-menu.tsx`)
  - 操作メニューの実装

### カスタムフック

- **useCompanies** (`hooks/use-companies.ts`)
  - 会社データの取得・管理
  - 検索フィルタリング機能
  - CRUD操作の実装
  - エラー状態の管理

## API仕様

### エンドポイント

| エンドポイント            | メソッド | 説明             |
| ------------------------- | -------- | ---------------- |
| `/api/v1/companies`       | GET      | 会社一覧取得     |
| `/api/v1/companies`       | POST     | 会社新規作成     |
| `/api/v1/companies/[id]`  | GET      | 会社詳細取得     |
| `/api/v1/companies/[id]`  | PUT      | 会社情報更新     |
| `/api/v1/companies/[id]`  | DELETE   | 会社削除         |
| `/api/v1/companies/stats` | GET      | 会社統計情報取得 |

### リクエスト仕様

#### 会社一覧取得

```typescript
interface CompanyFilters {
  search?: string;
  status?: 'all' | 'active' | 'inactive' | 'suspended';
  businessType?: string;
  city?: string;
}
```

#### レスポンス仕様

```typescript
interface Company {
  id: string;
  name: string;
  nameKana: string;
  corporateNumber?: string;
  address: string;
  phoneNumber: string;
  email: string;
  representativeName: string;
  representativePosition?: string;
  businessType: string;
  establishedDate?: string;
  capital?: string;
  employeeCount?: number;
  status: 'active' | 'inactive' | 'suspended';
  notes?: string;
  createdAt: string;
  updatedAt: string;
}
```

## UI/UX仕様

### レスポンシブデザイン

- **デスクトップ**: フル機能のテーブル表示
- **タブレット**: 1024px以下でもテーブル構造を維持
- **モバイル**: 768px以下では適切なレイアウト調整

### アクセシビリティ

- **キーボードナビゲーション**: すべての操作がキーボードで実行可能
- **スクリーンリーダー対応**: 適切なARIA属性とalt属性
- **フォーカス管理**: 視覚的に明確なフォーカス表示
- **コントラスト比**: WCAG 2.1 AA準拠

### インタラクション

#### ホバー効果

- **テーブル行**: マウスオーバー時の背景色変更
- **ボタン**: ホバー時の色変更とトランジション
- **リンク**: ホバー時の色変更

#### ローディング状態

- **初期読み込み**: 中央配置のスピナーとメッセージ
- **検索中**: 検索ボックス内のローディング表示（必要に応じて）
- **削除中**: ボタンの無効化とローディング表示

#### 空状態

- **データなし**: 中央配置のアイコンとメッセージ
- **検索結果なし**: 検索条件変更を促すメッセージ
- **エラー状態**: 適切なエラーメッセージとリトライ機能

### カラーテーマ

- **shadcn/ui**: デフォルトテーマを使用
- **ステータス色**: 意味に応じた色分け（緑、灰、黄）
- **危険操作**: 削除ボタンは destructive カラー使用
- **一貫性**: プロジェクト全体のデザインシステムに準拠

## パフォーマンス最適化

### データ管理

- **メモ化**: 検索パラメータのメモ化で不要な再レンダリング防止
- **状態管理**: 効率的な状態更新とイミュータブル操作
- **楽観的更新**: UI応答性向上のための即座の状態反映

### レンダリング最適化

- **React.memo**: 不要な再レンダリングの防止
- **useCallback**: イベントハンドラーのメモ化
- **useMemo**: 計算処理のメモ化

### ネットワーク最適化

- **リクエスト最適化**: 不要なAPI呼び出しの削減
- **エラーリトライ**: 失敗時の適切なリトライ機能
- **キャッシュ戦略**: 適切なデータキャッシュ

## セキュリティ仕様

### 入力検証

- **XSS対策**: Reactの自動エスケープ機能
- **入力サニタイズ**: 検索クエリの適切な処理
- **SQLインジェクション対策**: パラメータ化クエリの使用

### 認証・認可

- **JWT認証**: トークンベース認証
- **権限チェック**: 運営者権限の確認
- **セッション管理**: 適切なセッション制御

### データ保護

- **HTTPS通信**: 暗号化通信の強制
- **機密情報**: 適切なデータマスキング
- **監査ログ**: 操作履歴の記録

## 開発環境での動作

### モックデータ

開発環境では以下のモック会社データを使用：

- 株式会社ケアサポート (アクティブ)
- 有限会社ライフケア (アクティブ)
- 合同会社ヘルスケア (アクティブ)
- 株式会社シニアサポート (アクティブ)
- 有限会社ケアネット (非アクティブ)
- 株式会社ウェルフェアパートナーズ (一時停止)

### テスト機能

- **検索テスト**: 各種検索条件での動作確認
- **ソートテスト**: 各列でのソート動作確認
- **CRUD操作**: 作成・更新・削除操作の確認
- **エラーハンドリング**: エラー状態の表示確認

## 参考資料

- [CareBase-admin プロジェクト](https://github.com/ambi-tious/CareBase-admin)
- [運営者画面一覧](../../../docs/運営者.md)
- [画面一覧インデックス](../../../docs/screen-list.md)
- [CompanyTable コンポーネント](../../../components/3_organisms/tables/company-table.tsx)
- [useCompanies フック](../../../hooks/use-companies.ts)
- [Company 型定義](../../../types/company.ts)
- [shadcn/ui ドキュメント](https://ui.shadcn.com/)
