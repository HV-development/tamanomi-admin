# パスワードリマインダー画面設計書

- 画面名: `運営者パスワードリセット`
- パス: `/operation/password-reset`
- URL: https://carebase-admin.vercel.app/operation/password-reset

## 概要

パスワードリマインダー画面設計書です。
パスワードを忘れた運営者が、メールアドレスを入力してパスワードリセット機能を利用できる画面を提供します。
運営者として登録されているメールアドレスの確認を行い、成功時にはメール送信と成功画面への遷移を実装します。

認証フローは以下の通りです：

1. メールアドレスを入力してリマインダーを要求
2. 運営者として登録されているメールアドレスかチェック
3. チェックが通ればパスワードリセット用メールを送信
4. 成功画面に遷移してメール送信完了を通知
5. メール内のリンクからパスワードリセット画面へ遷移

## 全体レイアウト

<img width="409" height="329" alt="image" src="https://github.com/user-attachments/assets/d8da2e71-0614-4b6e-9abc-ad5e420a4e2c" />

### 画面構成

パスワードリマインダー画面は、CareBaseロゴ、リマインダーフォーム、フッターで構成されます。
シンプルで分かりやすいデザインを採用し、ユーザーが迷わずにパスワードリセット手続きを進められるよう配慮されています。

### 画面項目

| 項目名               | コンポーネント  | 必須 | 最小桁数 | 最大桁数 | フォーマット | 初期値                                                                                               | 備考                                                 |
| -------------------- | --------------- | ---- | -------- | -------- | ------------ | ---------------------------------------------------------------------------------------------------- | ---------------------------------------------------- |
| ページタイトル       | CardTitle       | -    | -        | -        | -            | 運営者パスワードリセット                                                                             | カード内ヘッダー                                     |
| ページ説明           | CardDescription | -    | -        | -        | -            | 登録済みのメールアドレスを入力してください。パスワード再設定用のリンクを記載したメールを送信します。 | カード内説明文                                       |
| メールアドレス       | Input           | ◯    | 1        | -        | email        | -                                                                                                    | メール入力フィールド、リアルタイムバリデーション対応 |
| エラーメッセージ     | テキスト        | -    | -        | -        | -            | -                                                                                                    | バリデーションエラー時に表示                         |
| 送信ボタン           | Button          | -    | -        | -        | -            | 送信                                                                                                 | メール送信実行ボタン、ローディング状態表示機能付き   |
| ログインへ戻るリンク | Link            | -    | -        | -        | -            | ログインに戻る                                                                                       | ログイン画面への戻りリンク                           |

### 成功表示項目

<img width="403" height="559" alt="image" src="https://github.com/user-attachments/assets/e89df8bd-317a-4bb0-a8b8-96ef18b061f1" />

| 項目名         | コンポーネント | 表示条件         | 内容                                                                       | 備考                           |
| -------------- | -------------- | ---------------- | -------------------------------------------------------------------------- | ------------------------------ |
| 成功メッセージ | テキスト       | メール送信成功時 | パスワード再設定用のメールを送信しました。メールボックスをご確認ください。 | メール送信完了の通知メッセージ |

## 機能仕様

### アクション

| 項目名         | 処理内容                          | 対象API                                       | 遷移先画面                              |
| -------------- | --------------------------------- | --------------------------------------------- | --------------------------------------- |
| 送信ボタン     | メールアドレスでリマインダー要求  | `/api/v1/auth/admin/operation/password-reset` | 成功画面表示（同一画面内）              |
| フォーム送信   | Enterキー押下時のリマインダー実行 | 同上                                          | 同上                                    |
| ログインへ戻る | ログイン画面へ遷移                | -                                             | 運営者ログイン画面 (`/operation/login`) |

### 入力チェック（リアルタイムバリデーション）

| 項目名         | イベント   | チェック内容         | エラーメッセージ                               |
| -------------- | ---------- | -------------------- | ---------------------------------------------- |
| メールアドレス | input/blur | 必須項目チェック     | メールアドレスを入力してください               |
| メールアドレス | input/blur | フォーマットチェック | 正しいメールアドレスを入力してください         |
| フォーム全体   | submit     | 運営者登録チェック   | 運営者として登録されていないメールアドレスです |

### バリデーション仕様

#### リアルタイムバリデーション

- React Hookによる入力中のフィールドレベルバリデーション
- `touched` 状態管理により、フィールドがフォーカスされた後にバリデーションを実行
- エラー状態の場合、フィールドを赤色でハイライト
- エラーメッセージをフィールド下部に表示
- 開発環境では緩和されたバリデーションを使用

#### フォームバリデーション

- メールアドレスが有効かつ空でない場合のみ送信ボタンを有効化
- 無効な状態では `disabled` 属性を設定
- 動的な有効性チェック

#### ローディング状態

- メール送信処理中はローディングスピナーを表示
- ボタンテキストが「送信中...」に変更
- フォーム全体が無効化され、重複送信を防止

### 画面遷移仕様

#### 通常フロー

1. **初期表示**
   - メールアドレス入力フォームを表示
   - 送信ボタンとログインへ戻るリンクを表示

2. **メール送信処理**
   - 送信ボタン押下時にバリデーション実行
   - API呼び出しでメール送信処理
   - 成功時は同一画面内で成功メッセージ表示

3. **成功画面表示**
   - フォームを非表示にし、成功メッセージを表示
   - ユーザーはメールボックスを確認してリセット手続きを続行

#### エラーハンドリング

- メールアドレス未入力：フィールドレベルのエラー表示
- フォーマット不正：フィールドレベルのエラー表示
- 未登録メールアドレス：フォームレベルのエラー表示
- 通信エラー：フォームレベルのエラー表示

## 開発環境での認証

### メール送信フロー詳細

1. **バリデーション**
   - メールアドレス形式の検証
   - 必須項目チェック
   - 運営者登録状況の確認

2. **メール送信処理**
   - パスワードリセット用トークンの生成
   - メール送信API呼び出し
   - 開発環境ではコンソールログで確認

3. **成功時の状態管理**
   - 送信完了フラグの設定
   - 成功メッセージの表示
   - フォームの非表示化

## コンポーネント構成

### 主要コンポーネント

- **PasswordReminderForm** (新規作成想定)
  - フォーム全体の制御とレイアウト
  - メール送信状態の管理
  - shadcn/ui Cardコンポーネントを使用

- **Input** (`components/ui/input.tsx`)
  - shadcn/ui Input コンポーネント
  - type="email" 対応
  - required属性による基本バリデーション

- **Button** (`components/ui/button.tsx`)
  - shadcn/ui Button コンポーネント
  - type="submit" でフォーム送信
  - className="w-full" で全幅表示

- **Card関連** (`components/ui/card.tsx`)
  - Card, CardContent, CardDescription, CardTitle
  - リマインダーフォームのコンテナとして使用

- **Label** (`components/ui/label.tsx`)
  - shadcn/ui Label コンポーネント
  - フォームフィールドのラベル表示

### 状態管理

- **useState** フック
  - email, submitted, error, isLoading の状態管理
  - リアルタイムな入力値と送信状態の追跡

- **useRouter** フック
  - Next.js App Router による画面遷移
  - ログイン画面への戻り機能

## API仕様

### エンドポイント

| エンドポイント                                   | 説明                   |
| ------------------------------------------------ | ---------------------- |
| `/api/v1/auth/admin/operation/password-reminder` | パスワードリマインダー |
| `/api/v1/auth/admin/password-reset`              | パスワードリセット     |

### リマインダーレスポンス

```typescript
interface PasswordReminderResponse {
  success: boolean;
  message?: string;
  error?: string;
}

interface PasswordReminderResult {
  success: boolean;
  error?: string;
}
```

### リクエスト仕様

```typescript
interface PasswordReminderRequest {
  email: string;
}
```

## UI/UX仕様

### レスポンシブデザイン

- **デスクトップ**: 最大幅 `max-w-md` (384px) のカード表示
- **タブレット**: 1024px以下でも同様のレイアウトを維持
- **モバイル**: 375px以下でも適切に表示

### アクセシビリティ

- 適切なラベル付け（Label コンポーネント使用）
- キーボードナビゲーション対応
- スクリーンリーダー対応
- 適切なコントラスト比の確保
- エラーメッセージの適切な関連付け

### カラーテーマ

- shadcn/ui のデフォルトテーマを使用
- エラー状態: `text-red-500` クラス
- 成功状態: `text-green-600` クラス
- 一貫したデザインシステムの適用

### ユーザビリティの考慮

- 明確で分かりやすいメッセージ表示
- 送信処理中の適切なフィードバック
- エラー状態の明確な表示
- ログイン画面への明確な戻り導線

## セキュリティ仕様

### 入力検証

- メールアドレスフォーマットの検証
- XSS対策（React の自動エスケープ）
- CSRF対策（APIトークンによる保護）

### メール送信セキュリティ

- レート制限による連続送信防止
- トークンの有効期限設定（通常24時間）
- メールアドレスの存在確認を攻撃者に悟られない設計

### プライバシー保護

- 未登録メールアドレスに対する情報漏洩防止
- ログ出力時の個人情報マスキング

## 参考資料

- [ログイン画面設計書](../operation/login/README.md)
- [既存ログインフォームコンポーネント](../../../components/2_molecules/login-form.tsx)
- [既存パスワードリセット機能](../password-reset/page.tsx)
- [RequestPasswordResetForm コンポーネント](../../../components/2_molecules/request-password-reset-form.tsx)
- [shadcn/ui ドキュメント](https://ui.shadcn.com/)
- [CareBase-admin Issue #235](https://github.com/ambi-tious/CareBase-admin/issues/235)
